<!doctype html>
<html><head>
<script type="text/javascript" src="../mgrl.js"></script>
<script type="text/javascript">

var random_uri = "http://lunpa.org/library/m_editor_screenshot.jpg";
var dead_pixel = "http://lunpa.org/library/tiny_image.png";

var debug = function (message) {
   var console = document.getElementById("console");
   console.innerHTML += "<p> - " + message + "</p>";
};

window.addEventListener("load", function () {
    m.media.onload = function () {
	debug("all pending media is now ready");
    };
    m.media.request_image(random_uri, function (asset) {
	debug("asset loaded: " + asset.uri);
    });
    m.media.request_image(dead_pixel);
    m.media.set_hint("default", dead_pixel);
    bs_loop();
});

var bs_loop = function () {
    var found = m.media.fetch(random_uri, "bs hint");
    if (!found) {
	debug("no asset or placeholder found: " + random_uri);
	window.setTimeout(bs_loop, 1000);
    }
    else if (found.src !== random_uri) {
	debug("placeholder found");
	window.setTimeout(bs_loop, 200);
    }
    else {
	debug("asset found");
    }
};


</script>
</head>
<body>
  <h2>Demo output:</h2>
  <div id="console"></div>
</body>
</html>
